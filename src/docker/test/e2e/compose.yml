services:
  tests:
    image: seedsync/test/e2e
    container_name: seedsync_test_e2e
    build:
      context: ../../../../
      dockerfile: src/docker/test/e2e/Dockerfile
      target: seedsync_test_e2e
    depends_on:
      - remote
    # Playwright needs more shared memory for browser
    shm_size: 1024M

  remote:
    image: seedsync/test/e2e/remote
    container_name: seedsync_test_e2e_remote
    # Platform must match myapp so scanfs binary can execute
    platform: ${SEEDSYNC_PLATFORM:-linux/amd64}
    build:
      context: ../../../../
      dockerfile: src/docker/test/e2e/remote/Dockerfile
      platforms:
        - ${SEEDSYNC_PLATFORM:-linux/amd64}

  configure:
    image: seedsync/test/e2e/configure
    container_name: seedsync_test_e2e_configure
    build:
      context: ../../../../
      dockerfile: src/docker/test/e2e/configure/Dockerfile
    depends_on:
      - myapp
