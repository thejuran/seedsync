version: "3.4"
services:
  tests:
    image: seedsync/test/e2e
    container_name: seedsync_test_e2e
    hostname: tests
    build:
      context: ../../../../
      dockerfile: src/docker/test/e2e/Dockerfile
      target: seedsync_test_e2e
    depends_on:
      myapp:
        condition: service_started
      remote:
        condition: service_started
      configure:
        condition: service_completed_successfully
    # Playwright needs more shared memory for browser
    shm_size: 1024M
    dns:
      - 8.8.8.8
      - 8.8.4.4
    networks:
      - e2e_network

  remote:
    image: seedsync/test/e2e/remote
    container_name: seedsync_test_e2e_remote
    hostname: remote
    build:
      context: ../../../../
      dockerfile: src/docker/test/e2e/remote/Dockerfile
    dns:
      - 8.8.8.8
      - 8.8.4.4
    networks:
      - e2e_network

  configure:
    image: seedsync/test/e2e/configure
    container_name: seedsync_test_e2e_configure
    hostname: configure
    build:
      context: ../../../../
      dockerfile: src/docker/test/e2e/configure/Dockerfile
    depends_on:
      - myapp
    dns:
      - 8.8.8.8
      - 8.8.4.4
    networks:
      - e2e_network

networks:
  e2e_network:
    name: seedsync_e2e_network
    driver: bridge
