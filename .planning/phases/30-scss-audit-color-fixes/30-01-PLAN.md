---
phase: 30-scss-audit-color-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/angular/src/styles.scss
  - src/angular/src/app/common/_bootstrap-overrides.scss
  - src/angular/src/app/pages/files/file-options.component.html
autonomous: true

must_haves:
  truths:
    - "Form inputs show light background in light mode and dark background in dark mode"
    - "Dropdown menus respect global theme setting (no hardcoded data-bs-theme attributes)"
    - "Custom app CSS variables exist for both light and dark theme contexts"
  artifacts:
    - path: "src/angular/src/styles.scss"
      provides: "Custom --app-* CSS variable definitions for light and dark themes"
      contains: "--app-"
    - path: "src/angular/src/app/common/_bootstrap-overrides.scss"
      provides: "Theme-aware form control and dropdown styling"
      contains: "data-bs-theme"
    - path: "src/angular/src/app/pages/files/file-options.component.html"
      provides: "Dropdown template without hardcoded data-bs-theme"
  key_links:
    - from: "src/angular/src/styles.scss"
      to: "src/angular/src/app/common/_bootstrap-overrides.scss"
      via: "CSS custom properties cascade"
      pattern: "--app-"
    - from: "src/angular/src/app/pages/files/file-options.component.html"
      to: "src/angular/src/app/common/_bootstrap-overrides.scss"
      via: "Bootstrap dropdown CSS variables apply via global data-bs-theme"
      pattern: "dropdown"
---

<objective>
Define custom theme-aware CSS variables, make form controls respect both themes, and fix dropdown menus to use global theme instead of hardcoded dark mode.

Purpose: Establishes the CSS variable foundation that Plan 02 component migrations depend on, and fixes the two cross-cutting concerns (forms and dropdowns) that are styled in shared SCSS files rather than component files.

Output: Custom CSS variables in styles.scss, theme-scoped form styling in bootstrap-overrides.scss, dropdown templates without hardcoded data-bs-theme.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-scss-audit-color-fixes/30-RESEARCH.md
@.planning/phases/29-theme-infrastructure/29-01-SUMMARY.md
@src/angular/src/styles.scss
@src/angular/src/app/common/_bootstrap-overrides.scss
@src/angular/src/app/common/_bootstrap-variables.scss
@src/angular/src/app/pages/files/file-options.component.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define custom CSS variables and make form controls theme-aware</name>
  <files>
    src/angular/src/styles.scss
    src/angular/src/app/common/_bootstrap-overrides.scss
  </files>
  <action>
**Part A: Add custom CSS variable definitions to styles.scss**

After the existing `html, body` rule block (around line 86), add two new blocks defining custom app-specific CSS variables that component SCSS files will consume:

```scss
// ============================================================================
// SECTION 5: Custom Theme Variables
// ============================================================================
// App-specific CSS variables that adapt to Bootstrap's data-bs-theme system.
// Components use var(--app-*) for colors that Bootstrap doesn't provide.

:root, [data-bs-theme="light"] {
  // Layout backgrounds
  --app-header-bg: #DDDDDD;
  --app-top-header-bg: #f5f5f5;
  --app-sidebar-overlay-bg: rgba(0, 0, 0, 0.25);

  // File list
  --app-file-header-bg: #212529;
  --app-file-header-color: #ffffff;
  --app-file-row-even: #F6F6F6;
  --app-file-border-color: #ddd;
  --app-bulk-overlay-bg: rgba(255, 255, 255, 0.8);

  // Text
  --app-logo-color: #118247;
  --app-muted-text: #666;
  --app-separator-color: #999;

  // Accents
  --app-accent-teal-border: #6ac19e;
}

[data-bs-theme="dark"] {
  // Layout backgrounds
  --app-header-bg: #343a40;
  --app-top-header-bg: #1a1d20;
  --app-sidebar-overlay-bg: rgba(0, 0, 0, 0.5);

  // File list
  --app-file-header-bg: #1a1d20;
  --app-file-header-color: #f8f9fa;
  --app-file-row-even: #2b3035;
  --app-file-border-color: #495057;
  --app-bulk-overlay-bg: rgba(33, 37, 41, 0.8);

  // Text
  --app-logo-color: #4ac98f;
  --app-muted-text: #adb5bd;
  --app-separator-color: #6c757d;

  // Accents
  --app-accent-teal-border: #4ac98f;
}
```

Keep file-header intentionally dark (black) in light mode as a design accent. In dark mode, use a very dark gray so it integrates better.

**Part B: Make form controls theme-aware in _bootstrap-overrides.scss**

The current form control styling (lines 61-103) is hardcoded for dark mode only. Restructure it:

1. Remove the unscoped `.form-control` and `.form-check-input` blocks (lines 61-103).
2. Replace with theme-scoped blocks:

```scss
// ============================================================================
// Theme-Aware Form Styling
// ============================================================================
// Form inputs adapt to the active theme. Light mode uses Bootstrap defaults
// (no overrides needed). Dark mode needs explicit dark backgrounds.

[data-bs-theme="dark"] {
  .form-control {
    background-color: #212529;
    color: #dee2e6;
    border-color: #495057;

    &::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    &:focus {
      background-color: #212529;
      color: #dee2e6;
    }

    &:disabled {
      background-color: #1a1a1a;
      opacity: 0.65;
    }
  }

  .form-check-input {
    background-color: #212529;
    border-color: #495057;

    &:focus {
      border-color: #{fn.tint-color(bv.$secondary, 50%)};
    }

    &:disabled {
      opacity: 0.5;
    }
  }
}
```

This ensures light mode uses Bootstrap's built-in light form styling (white backgrounds, dark text) while dark mode retains the existing dark styling. The `fn` and `bv` namespace references are already imported at the top of _bootstrap-overrides.scss.
  </action>
  <verify>
Run `cd /Users/julianamacbook/seedsync/src/angular && npx ng build --configuration development` and confirm zero errors. Then run `npm run lint` and confirm zero errors.
  </verify>
  <done>
styles.scss contains `:root, [data-bs-theme="light"]` and `[data-bs-theme="dark"]` blocks with --app-* variables. _bootstrap-overrides.scss form styling is scoped under `[data-bs-theme="dark"]` so light mode gets Bootstrap defaults.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix dropdown theming to respect global theme</name>
  <files>
    src/angular/src/app/pages/files/file-options.component.html
    src/angular/src/app/common/_bootstrap-overrides.scss
  </files>
  <action>
**Part A: Remove hardcoded data-bs-theme="dark" from dropdown HTML**

In `file-options.component.html`:
- Line 12: Remove `data-bs-theme="dark"` from `<div id="filter-status" class="dropdown" data-bs-theme="dark">` so it becomes `<div id="filter-status" class="dropdown">`
- Line 116: Remove `data-bs-theme="dark"` from `<div id="sort-status" class="dropdown" data-bs-theme="dark">` so it becomes `<div id="sort-status" class="dropdown">`

**Part B: Update dropdown overrides in _bootstrap-overrides.scss**

The existing `[data-bs-theme="dark"] .dropdown-menu` block (lines 18-38) is still valid and correct -- it provides custom dropdown colors specifically for dark mode. The dropdown styling uses CSS variables that Bootstrap's dark mode system already provides defaults for in light mode.

However, the dropdown-menu currently gets its custom blue/teal styling ONLY in dark mode. In light mode, Bootstrap defaults will apply (white background, dark text, standard hover). This is the correct behavior -- dropdowns should look native to each theme.

No changes needed to the existing `[data-bs-theme="dark"]` dropdown block in _bootstrap-overrides.scss. The block is already correctly scoped. The only change is removing the hardcoded attributes from the template so the global theme flows through.

Verify the comment on line 17 still makes sense after the change. Update it from:
```scss
// Dark dropdown theme (for file options dropdowns)
// Uses CSS variables so components only need data-bs-theme="dark" attribute
```
to:
```scss
// Custom dropdown theme colors for dark mode
// Applied when global data-bs-theme="dark" is set on documentElement by ThemeService
```
  </action>
  <verify>
Run `cd /Users/julianamacbook/seedsync/src/angular && npx ng build --configuration development` and confirm zero errors. Run `npm run lint` and confirm zero errors. Run `npx ng test --watch=false --browsers=ChromeHeadless` and confirm all tests pass. Grep for `data-bs-theme="dark"` in HTML templates -- should find ZERO matches in component HTML files (only in SCSS comments and test files).
  </verify>
  <done>
No HTML template contains hardcoded `data-bs-theme="dark"` attributes. Dropdowns inherit from the global theme set by ThemeService on `document.documentElement`. Dark mode gets custom blue/teal dropdown styling; light mode gets Bootstrap defaults.
  </done>
</task>

</tasks>

<verification>
1. `cd src/angular && npx ng build --configuration development` completes with zero errors
2. `cd src/angular && npm run lint` reports zero errors
3. `cd src/angular && npx ng test --watch=false --browsers=ChromeHeadless` all tests pass (412+)
4. `grep -r 'data-bs-theme="dark"' src/angular/src/app/ --include="*.html"` returns no matches
5. `grep -c '\-\-app-' src/angular/src/styles.scss` returns 20+ (custom variable definitions)
6. Form controls are scoped under `[data-bs-theme="dark"]` in _bootstrap-overrides.scss
</verification>

<success_criteria>
- Custom --app-* CSS variables defined for both light and dark themes in styles.scss
- Form controls are theme-aware: light mode uses Bootstrap defaults, dark mode uses dark overrides
- No hardcoded data-bs-theme="dark" in any HTML template
- Angular build, lint, and all tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/30-scss-audit-color-fixes/30-01-SUMMARY.md`
</output>
