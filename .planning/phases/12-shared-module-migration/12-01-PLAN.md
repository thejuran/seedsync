---
phase: 12-shared-module-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/angular/src/app/common/_common.scss
  - src/angular/src/app/common/_bootstrap-overrides.scss
autonomous: true

must_haves:
  truths:
    - "_common.scss uses @forward 'bootstrap-variables' as its first rule"
    - "_common.scss uses @use 'bootstrap-variables' as bv for local variable access"
    - "_common.scss uses @import 'bootstrap/scss/functions' for Bootstrap function access (hybrid pattern)"
    - "All $warning and $danger references in _common.scss use bv. namespace prefix"
    - "_bootstrap-overrides.scss uses @use 'bootstrap-variables' as bv instead of @import"
    - "All variable references in _bootstrap-overrides.scss use bv. namespace prefix"
    - "ng build --configuration development compiles with zero errors"
    - "All 381 Angular unit tests pass"
    - "No component files were modified"
  artifacts:
    - path: "src/angular/src/app/common/_common.scss"
      provides: "@forward aggregation module with hybrid Bootstrap function access"
      contains: "@forward 'bootstrap-variables'"
    - path: "src/angular/src/app/common/_bootstrap-overrides.scss"
      provides: "Namespaced variable access for Bootstrap overrides"
      contains: "@use 'bootstrap-variables' as bv"
  key_links:
    - from: "_common.scss"
      to: "_bootstrap-variables.scss"
      via: "@forward re-export to downstream components"
      pattern: "@forward 'bootstrap-variables'"
    - from: "_common.scss"
      to: "bootstrap/scss/functions"
      via: "@import for shade-color/tint-color function access (hybrid)"
      pattern: "@import 'bootstrap/scss/functions'"
    - from: "_bootstrap-overrides.scss"
      to: "_bootstrap-variables.scss"
      via: "@use with bv namespace for variable access"
      pattern: "@use 'bootstrap-variables' as bv"
    - from: "14 component files"
      to: "_common.scss"
      via: "@use '../../common/common' as * (unchanged, accesses forwarded vars)"
      pattern: "@use '../../common/common' as \\*"
---

<objective>
Transform `_common.scss` and `_bootstrap-overrides.scss` from deprecated `@import` to modern `@use/@forward` module system.

Purpose: Modernize the shared SCSS module layer to use Sass module system, eliminating @import deprecation warnings from application code while preserving the component API (`@use '../../common/common' as *`).
Output: `_common.scss` becomes a `@forward` aggregation module; `_bootstrap-overrides.scss` uses `@use` with explicit namespace. All 14 component files continue working without changes.
</objective>

<execution_context>
@/Users/julianamacbook/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianamacbook/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/milestones/v1.4-ROADMAP.md
@.planning/phases/12-shared-module-migration/12-RESEARCH.md
@src/angular/src/app/common/_common.scss
@src/angular/src/app/common/_bootstrap-overrides.scss
@src/angular/src/app/common/_bootstrap-variables.scss
@src/angular/src/styles.scss
</context>

<tasks>

<task type="auto">
  <name>Task 1: Transform _common.scss to @forward aggregation module</name>
  <files>src/angular/src/app/common/_common.scss</files>
  <action>
Replace the entire import section and derived variable section of _common.scss with the modern @forward/@use hybrid pattern. The file must follow this exact structure and ordering:

1. FIRST: Add `@forward 'bootstrap-variables';` as the very first rule (before anything else). This re-exports all variables from _bootstrap-variables.scss to downstream components that `@use` _common.scss.

2. SECOND: Add `@use 'bootstrap-variables' as bv;` immediately after the @forward. This gives _common.scss local access to the variables with the `bv` namespace.

3. THIRD: Add `@import 'bootstrap/scss/functions';` after the @use. This is the hybrid pattern — Bootstrap functions (shade-color, tint-color) are not available via @use because Bootstrap 5.3 uses @import internally. This is the one acceptable remaining @import in application code.

4. FOURTH: Update all 6 derived variable definitions to use `bv.` namespace prefix for variables from _bootstrap-variables.scss:
   - `shade-color($warning, 60%)` becomes `shade-color(bv.$warning, 60%)`
   - `shade-color($danger, 60%)` becomes `shade-color(bv.$danger, 60%)`
   - `tint-color($warning, 80%)` becomes `tint-color(bv.$warning, 80%)`
   - `tint-color($danger, 80%)` becomes `tint-color(bv.$danger, 80%)`
   - `tint-color($warning, 60%)` becomes `tint-color(bv.$warning, 60%)`
   - `tint-color($danger, 60%)` becomes `tint-color(bv.$danger, 60%)`

5. LEAVE UNCHANGED: All lines from the Layout Variables section onward ($gray-100, $gray-300, $gray-800, $small-max-width, $medium-min-width, etc.) remain exactly as-is. These are locally-defined constants, not imported from _bootstrap-variables.scss.

The complete target file should look like:

```scss
// Forward Bootstrap variables to components (makes them accessible via @use '../../common/common' as *)
@forward 'bootstrap-variables';

// Local access to Bootstrap variables with namespace
@use 'bootstrap-variables' as bv;

// Bootstrap functions (shade-color, tint-color) — hybrid @import required,
// Bootstrap 5.3 doesn't expose functions via @use
@import 'bootstrap/scss/functions';

// ============================================================================
// Bootstrap Semantic Color Variables (for component use)
// ============================================================================
// ...existing comments...

// Bootstrap 5.3 subtle alert color variables (generated from theme colors)
$warning-text-emphasis: shade-color(bv.$warning, 60%);
$danger-text-emphasis: shade-color(bv.$danger, 60%);
$warning-bg-subtle: tint-color(bv.$warning, 80%);
$danger-bg-subtle: tint-color(bv.$danger, 80%);
$warning-border-subtle: tint-color(bv.$warning, 60%);
$danger-border-subtle: tint-color(bv.$danger, 60%);

// Bootstrap gray scale (commonly used for borders, backgrounds)
$gray-100: #f8f9fa;
$gray-300: #dee2e6;
$gray-800: #343a40;

// ============================================================================
// Layout Variables
// ============================================================================
// ...rest of file unchanged...
```

CRITICAL: The ordering @forward -> @use -> @import -> variables is mandatory. @forward must be the first rule or Sass will throw a compilation error.

CRITICAL: Do NOT modify _bootstrap-variables.scss. It is already module-compatible (pure variable definitions, no imports).
  </action>
  <verify>
Run `cd /Users/julianamacbook/seedsync/src/angular && npx ng build --configuration development 2>&1 | head -50` to verify compilation succeeds.
Look for:
- Zero "Undefined variable" errors (confirms namespace prefixes are correct)
- Zero "Error: @forward rules must be written before any other rules" errors (confirms ordering)
- Deprecation warnings from Bootstrap are acceptable (third-party)
- One deprecation warning from _common.scss for `@import 'bootstrap/scss/functions'` is acceptable (hybrid pattern)
  </verify>
  <done>
_common.scss uses @forward 'bootstrap-variables' as first rule, @use 'bootstrap-variables' as bv for local access, @import 'bootstrap/scss/functions' for function access, and all 6 derived variables use bv. namespace prefix. File compiles without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Transform _bootstrap-overrides.scss to @use with namespace</name>
  <files>src/angular/src/app/common/_bootstrap-overrides.scss</files>
  <action>
Replace the `@import 'bootstrap-variables';` at line 5 with `@use 'bootstrap-variables' as bv;` and update all 7 variable references to use the `bv.` namespace prefix.

1. REPLACE line 5:
   - FROM: `@import 'bootstrap-variables';`
   - TO: `@use 'bootstrap-variables' as bv;`

2. UPDATE variable references in the dark dropdown theme section (7 references total):

   Line 20 (inside interpolation):
   - FROM: `--bs-dropdown-bg: #{$primary-color};`
   - TO: `--bs-dropdown-bg: #{bv.$primary-color};`

   Line 21 (inside interpolation):
   - FROM: `--bs-dropdown-border-color: #{$primary-dark-color};`
   - TO: `--bs-dropdown-border-color: #{bv.$primary-dark-color};`

   Line 27 (inside interpolation):
   - FROM: `--bs-dropdown-link-hover-bg: #{$secondary-dark-color};`
   - TO: `--bs-dropdown-link-hover-bg: #{bv.$secondary-dark-color};`

   Line 29 (inside interpolation):
   - FROM: `--bs-dropdown-link-active-bg: #{$secondary-dark-color};`
   - TO: `--bs-dropdown-link-active-bg: #{bv.$secondary-dark-color};`

   Line 35 (direct reference):
   - FROM: `background-color: $secondary-dark-color;`
   - TO: `background-color: bv.$secondary-dark-color;`

   Line 36 (direct reference):
   - FROM: `border-color: $secondary-darker-color;`
   - TO: `border-color: bv.$secondary-darker-color;`

   Line 94 (inside tint-color function call):
   - FROM: `border-color: tint-color($secondary, 50%);`
   - TO: `border-color: tint-color(bv.$secondary, 50%);`

3. LEAVE UNCHANGED: All CSS rules, comments, and structure. Only the import statement and variable references change.

4. NOTE on tint-color function access: `_bootstrap-overrides.scss` is loaded via `@import` from `styles.scss` (line 54). Since `styles.scss` imports Bootstrap functions globally (line 4: `@import '../node_modules/bootstrap/scss/functions'`), the `tint-color()` function is available in the global scope when `_bootstrap-overrides.scss` is evaluated. No additional @import of functions is needed in this file.

5. NOTE on comment-only references: Lines 75 (`$component-active-bg`), 90 (`$component-active-bg`), and 100 (`$form-check-input-disabled-opacity`) contain variable names only in comments. Do NOT namespace these — they are documentation references, not actual variable usage.
  </action>
  <verify>
Run `cd /Users/julianamacbook/seedsync/src/angular && npx ng build --configuration development 2>&1 | head -50` to verify compilation succeeds.
Look for:
- Zero "Undefined variable" errors in _bootstrap-overrides.scss
- Zero "Undefined function tint-color" errors (function still available from global scope)
- All CSS variable interpolations compile correctly (#{bv.$var} syntax)
  </verify>
  <done>
_bootstrap-overrides.scss uses @use 'bootstrap-variables' as bv instead of @import. All 7 variable references use bv. namespace prefix. Interpolation syntax (#{bv.$var}) compiles correctly. tint-color function still works from global scope.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify full build and tests pass</name>
  <files></files>
  <action>
Run the full verification suite to confirm zero regressions:

1. Run Angular build:
   ```bash
   cd /Users/julianamacbook/seedsync/src/angular && npx ng build --configuration development
   ```
   Expected: Build succeeds with zero errors. Deprecation warnings from Bootstrap and the one from _common.scss's @import of functions are acceptable.

2. Run Angular unit tests:
   ```bash
   cd /Users/julianamacbook/seedsync/src/angular && npx ng test --watch=false --browsers=ChromeHeadless
   ```
   Expected: All 381 tests pass.

3. Verify no component files were modified:
   ```bash
   cd /Users/julianamacbook/seedsync && git diff --name-only
   ```
   Expected: Only _common.scss and _bootstrap-overrides.scss appear in the diff. Zero component files changed.

4. Verify deprecation warning status by examining build output:
   - Application code warnings: Should see only the one @import in _common.scss (for Bootstrap functions)
   - Bootstrap/third-party warnings: Acceptable, will remain until Bootstrap 6
   - Component file warnings: Should be ZERO

If tests fail with "Undefined variable" errors, check that:
- @forward is the FIRST rule in _common.scss
- All bv. namespace prefixes are correct
- No variable reference was missed in either file
  </action>
  <verify>
Build completes with zero errors.
All 381 unit tests pass.
Only 2 files modified: _common.scss and _bootstrap-overrides.scss.
  </verify>
  <done>
Full build succeeds. All 381 unit tests pass. Only _common.scss and _bootstrap-overrides.scss were modified. Zero component file changes. Phase 12 complete.
  </done>
</task>

</tasks>

<verification>
1. `ng build --configuration development` completes with zero compilation errors
2. All 381 Angular unit tests pass (`ng test --watch=false`)
3. Only 2 files modified: `_common.scss` and `_bootstrap-overrides.scss`
4. Zero component files changed (verified by `git diff --name-only`)
5. `_common.scss` first rule is `@forward 'bootstrap-variables'`
6. `_bootstrap-overrides.scss` uses `@use 'bootstrap-variables' as bv`
7. All variable references in both files use `bv.` namespace prefix
8. Bootstrap functions (shade-color, tint-color) still work correctly
9. Interpolation syntax `#{bv.$var}` compiles correctly in CSS variable assignments
</verification>

<success_criteria>
- REQ-01: _common.scss transformed from @import to @forward aggregation module - SATISFIED
- REQ-02: _bootstrap-overrides.scss transformed from @import to @use with namespaces - SATISFIED
- REQ-07: All 14 component files continue working with modernized _common.scss - SATISFIED
- REQ-05: All 381 Angular unit tests pass - SATISFIED
</success_criteria>

<output>
After completion, create `.planning/phases/12-shared-module-migration/12-01-SUMMARY.md`
</output>
