# Plan 01-01: Project Scaffolding + Database Foundation

**Phase:** 1 -- Data Foundation
**Goal:** Complete project skeleton with working backend (FastAPI + SQLAlchemy + SQLite), frontend (React 19 + Vite 7 + TypeScript + Tailwind 4 + shadcn/ui), database models for contracts and point balances, and Alembic migrations -- so subsequent plans can build features immediately.
**Requirements:** DATA-01, DATA-02, DATA-03 (data model layer); foundational support for all Phase 1 requirements
**Depends on:** Nothing (first plan, first phase)

## Context

This is a greenfield project. No code exists yet -- just an empty git repo with a `.planning/` directory. This plan creates the entire monorepo skeleton, installs all dependencies, defines the core SQLAlchemy models (contracts, point balances), sets up Alembic migrations, creates the FastAPI app entry point with health check, scaffolds the React frontend with routing and layout shell, and writes foundational tests. Everything after this plan builds on top of this skeleton.

The monorepo pattern mirrors the user's existing NephSched project: `backend/` for FastAPI + `frontend/` for React/Vite, with `data/` for static point chart JSON files and `tests/` at the repo root.

## Tasks

### 1. Backend project setup (Python, FastAPI, SQLAlchemy, Alembic)

**File(s):**
- `backend/requirements.txt`
- `backend/requirements-dev.txt`
- `backend/main.py`
- `backend/db/database.py`
- `backend/db/__init__.py`
- `backend/models/__init__.py`
- `backend/models/contract.py`
- `backend/models/point_balance.py`
- `backend/engine/__init__.py`
- `backend/engine/use_year.py`
- `backend/engine/eligibility.py`
- `backend/api/__init__.py`
- `backend/__init__.py`
- `alembic.ini`
- `backend/db/migrations/env.py`
- `backend/db/migrations/script.py.mako`
- `backend/db/migrations/versions/.gitkeep`
- `.gitignore`

**Action:** Create the backend project structure.

**`backend/requirements.txt`:**
```
fastapi[standard]>=0.128.0,<0.129.0
sqlalchemy>=2.0.46,<2.1.0
aiosqlite>=0.21.0,<0.22.0
alembic>=1.18.0,<1.19.0
pydantic>=2.12.0,<2.13.0
python-dateutil>=2.9.0,<3.0.0
uvicorn[standard]>=0.34.0,<0.35.0
```

**`backend/requirements-dev.txt`:**
```
-r requirements.txt
pytest>=8.0.0
pytest-asyncio>=0.25.0
httpx>=0.28.0
ruff>=0.9.0
```

**`backend/db/database.py`:** Create async SQLAlchemy engine and session factory.
```python
from sqlalchemy.ext.asyncio import create_async_engine, async_sessionmaker, AsyncSession
from sqlalchemy.orm import DeclarativeBase
import os

DATABASE_URL = os.getenv("DATABASE_URL", "sqlite+aiosqlite:///./dvc.db")

engine = create_async_engine(DATABASE_URL, echo=False)
async_session = async_sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)

class Base(DeclarativeBase):
    pass

async def get_db():
    async with async_session() as session:
        yield session
```

**`backend/models/contract.py`:** Define the Contract model.
```python
from sqlalchemy import Column, Integer, String, Boolean, Enum as SAEnum, DateTime
from sqlalchemy.orm import relationship
from backend.db.database import Base
import enum
from datetime import datetime

class PurchaseType(str, enum.Enum):
    RESALE = "resale"
    DIRECT = "direct"

class UseYearMonth(int, enum.Enum):
    FEBRUARY = 2
    MARCH = 3
    APRIL = 4
    JUNE = 6
    AUGUST = 8
    SEPTEMBER = 9
    OCTOBER = 10
    DECEMBER = 12

class Contract(Base):
    __tablename__ = "contracts"

    id = Column(Integer, primary_key=True, autoincrement=True)
    name = Column(String, nullable=True)  # optional friendly name like "Our Poly contract"
    home_resort = Column(String, nullable=False)  # resort slug/key e.g. "polynesian"
    use_year_month = Column(Integer, nullable=False)  # 2,3,4,6,8,9,10,12
    annual_points = Column(Integer, nullable=False)
    purchase_type = Column(String, nullable=False, default=PurchaseType.RESALE.value)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)

    point_balances = relationship("PointBalance", back_populates="contract", cascade="all, delete-orphan")
```

Use `String` for `purchase_type` and `home_resort` to keep things simple and avoid SQLite enum issues. Validation happens at the Pydantic schema layer.

**`backend/models/point_balance.py`:** Define the PointBalance model for manual point entry.
```python
from sqlalchemy import Column, Integer, String, ForeignKey, DateTime
from sqlalchemy.orm import relationship
from backend.db.database import Base
import enum
from datetime import datetime

class PointAllocationType(str, enum.Enum):
    CURRENT = "current"       # current use year allocation
    BANKED = "banked"         # banked from prior use year
    BORROWED = "borrowed"     # borrowed from next use year
    HOLDING = "holding"       # holding account (late cancellation, etc.)

class PointBalance(Base):
    __tablename__ = "point_balances"

    id = Column(Integer, primary_key=True, autoincrement=True)
    contract_id = Column(Integer, ForeignKey("contracts.id"), nullable=False)
    use_year = Column(Integer, nullable=False)  # the use year these points belong to (e.g. 2026)
    allocation_type = Column(String, nullable=False, default=PointAllocationType.CURRENT.value)
    points = Column(Integer, nullable=False, default=0)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)

    contract = relationship("Contract", back_populates="point_balances")
```

This supports the STATE.md requirement: "add point allocation type (normal/banked/borrowed/holding)". Each row represents a distinct point bucket for a contract in a specific use year.

**`backend/models/__init__.py`:**
```python
from backend.models.contract import Contract, PurchaseType, UseYearMonth
from backend.models.point_balance import PointBalance, PointAllocationType
```

**`backend/main.py`:** FastAPI app with CORS, health check, and lifespan for DB init.
```python
from contextlib import asynccontextmanager
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from backend.db.database import engine, Base

@asynccontextmanager
async def lifespan(app: FastAPI):
    # Create tables on startup (dev convenience; production uses Alembic)
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)
    yield

app = FastAPI(title="DVC Dashboard API", version="0.1.0", lifespan=lifespan)

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],  # Vite dev server
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.get("/api/health")
async def health_check():
    return {"status": "ok", "version": "0.1.0"}
```

**Alembic setup:** Create `alembic.ini` at repo root pointing to `backend/db/migrations/`. Create `backend/db/migrations/env.py` that imports `Base` from `backend.db.database` and all models from `backend.models` so autogenerate detects them. Use async migration runner (`run_async_migrations`). Set `sqlalchemy.url` to `sqlite+aiosqlite:///./dvc.db` in alembic.ini.

**`backend/engine/use_year.py`:** Stub file with docstring explaining this will contain use year date math functions. Include a single utility:
```python
from datetime import date
from dateutil.relativedelta import relativedelta

USE_YEAR_MONTHS = [2, 3, 4, 6, 8, 9, 10, 12]

def get_use_year_start(use_year_month: int, year: int) -> date:
    """Return the start date of a use year (1st of use_year_month in given year)."""
    return date(year, use_year_month, 1)

def get_use_year_end(use_year_month: int, year: int) -> date:
    """Return the end date of a use year (last day before next UY starts)."""
    start = get_use_year_start(use_year_month, year)
    return start + relativedelta(years=1) - relativedelta(days=1)

def get_banking_deadline(use_year_month: int, year: int) -> date:
    """Banking deadline is 8 months into the use year."""
    start = get_use_year_start(use_year_month, year)
    # Last day of the 8th month of the use year
    eight_months = start + relativedelta(months=8)
    return eight_months - relativedelta(days=1)
```

**`backend/engine/eligibility.py`:** Stub with the resort classification data needed for resale restriction logic:
```python
"""Booking eligibility resolver -- determines which resorts a contract can book."""

# Original 14 DVC resorts (pre-January 2019) -- resale contracts can book any of these
ORIGINAL_14_RESORTS = [
    "old_key_west",
    "boardwalk",
    "wilderness_lodge_boulder_ridge",  # Boulder Ridge Villas
    "wilderness_lodge_copper_creek",   # Copper Creek Villas
    "beach_club",
    "hilton_head",
    "vero_beach",
    "animal_kingdom_jambo",
    "animal_kingdom_kidani",
    "saratoga_springs",
    "bay_lake_tower",
    "grand_floridian",
    "polynesian",
    "aulani",
]

# Post-January 2019 resorts -- resale contracts can ONLY book home resort
RESTRICTED_RESORTS = [
    "riviera",
    "disneyland_hotel",           # Villas at Disneyland Hotel
    "cabins_fort_wilderness",     # Cabins at Fort Wilderness
]

ALL_RESORTS = ORIGINAL_14_RESORTS + RESTRICTED_RESORTS
```

**`.gitignore`:** Add standard Python/Node ignores: `__pycache__/`, `*.pyc`, `.venv/`, `venv/`, `node_modules/`, `dist/`, `*.db`, `.env`, `.DS_Store`, `frontend/dist/`, `backend/db/migrations/versions/*.pyc`.

**Empty `__init__.py` files** in: `backend/`, `backend/db/`, `backend/api/`, `backend/engine/`.

### 2. Frontend project setup (React 19, Vite 7, TypeScript, Tailwind 4, shadcn/ui, routing)

**File(s):**
- `frontend/` (entire Vite scaffold)
- `frontend/package.json`
- `frontend/tsconfig.json`
- `frontend/vite.config.ts`
- `frontend/src/main.tsx`
- `frontend/src/App.tsx`
- `frontend/src/index.css`
- `frontend/src/pages/ContractsPage.tsx`
- `frontend/src/pages/PointChartsPage.tsx`
- `frontend/src/components/Layout.tsx`
- `frontend/src/lib/api.ts`
- `frontend/src/lib/utils.ts`
- `frontend/src/types/index.ts`

**Action:** Create the frontend project.

Run `npm create vite@latest frontend -- --template react-ts` from the repo root. Then `cd frontend` and install dependencies:

```bash
npm install react@^19.2.0 react-dom@^19.2.0 \
  @tanstack/react-query@^5.90.0 \
  react-router-dom@^7.0.0 \
  date-fns@^4.1.0 \
  zustand@^5.0.0

npm install -D tailwindcss@^4.0.0 @tailwindcss/vite
```

Initialize shadcn/ui:
```bash
npx shadcn@latest init
```
Then add initial components:
```bash
npx shadcn@latest add button card dialog input label select table badge
```

**`frontend/src/index.css`:** Import Tailwind:
```css
@import "tailwindcss";
```

**`frontend/vite.config.ts`:** Add Tailwind plugin and proxy API calls to backend:
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'

export default defineConfig({
  plugins: [react(), tailwindcss()],
  server: {
    proxy: {
      '/api': 'http://localhost:8000',
    },
  },
})
```

**`frontend/src/types/index.ts`:** Define TypeScript types matching backend models:
```typescript
export type PurchaseType = "resale" | "direct";
export type PointAllocationType = "current" | "banked" | "borrowed" | "holding";

export const USE_YEAR_MONTHS = [2, 3, 4, 6, 8, 9, 10, 12] as const;
export type UseYearMonth = typeof USE_YEAR_MONTHS[number];

export const USE_YEAR_MONTH_NAMES: Record<UseYearMonth, string> = {
  2: "February",
  3: "March",
  4: "April",
  6: "June",
  8: "August",
  9: "September",
  10: "October",
  12: "December",
};

export interface Contract {
  id: number;
  name: string | null;
  home_resort: string;
  use_year_month: UseYearMonth;
  annual_points: number;
  purchase_type: PurchaseType;
  created_at: string;
  updated_at: string;
}

export interface PointBalance {
  id: number;
  contract_id: number;
  use_year: number;
  allocation_type: PointAllocationType;
  points: number;
  updated_at: string;
}

export interface Resort {
  slug: string;
  name: string;
  short_name: string;
  restricted: boolean;  // true for post-2019 resorts
}
```

**`frontend/src/lib/api.ts`:** Base API client using fetch:
```typescript
const BASE_URL = "/api";

async function request<T>(path: string, options?: RequestInit): Promise<T> {
  const res = await fetch(`${BASE_URL}${path}`, {
    headers: { "Content-Type": "application/json", ...options?.headers },
    ...options,
  });
  if (!res.ok) {
    const error = await res.json().catch(() => ({ detail: res.statusText }));
    throw new Error(error.detail || "API request failed");
  }
  return res.json();
}

export const api = {
  get: <T>(path: string) => request<T>(path),
  post: <T>(path: string, body: unknown) => request<T>(path, { method: "POST", body: JSON.stringify(body) }),
  put: <T>(path: string, body: unknown) => request<T>(path, { method: "PUT", body: JSON.stringify(body) }),
  delete: <T>(path: string) => request<T>(path, { method: "DELETE" }),
};
```

**`frontend/src/components/Layout.tsx`:** App shell with sidebar navigation. Include nav links for: Contracts, Point Charts. Use Tailwind for layout: fixed sidebar on the left (w-64), main content area on the right. Include the app title "DVC Dashboard" in the sidebar header. Keep styling minimal but functional.

**`frontend/src/App.tsx`:** Set up React Router with routes:
- `/` redirects to `/contracts`
- `/contracts` -- ContractsPage (Plan 01-02)
- `/point-charts` -- PointChartsPage (Plan 01-03)

Wrap in `QueryClientProvider` from TanStack Query.

**`frontend/src/pages/ContractsPage.tsx`:** Placeholder page with heading "Contracts" and text "Contract management coming in Plan 01-02."

**`frontend/src/pages/PointChartsPage.tsx`:** Placeholder page with heading "Point Charts" and text "Point chart viewer coming in Plan 01-03."

**`frontend/src/main.tsx`:** Standard React 19 entry point rendering `<App />` into `#root`.

### 3. DVC resort reference data + Alembic initial migration + backend tests

**File(s):**
- `data/resorts.json`
- `backend/data/__init__.py`
- `backend/data/resorts.py`
- `backend/api/contracts.py` (stub router)
- `backend/api/points.py` (stub router)
- `tests/__init__.py`
- `tests/conftest.py`
- `tests/test_models.py`
- `tests/test_use_year.py`

**Action:** Create reference data, wire up API router stubs, and write initial tests.

**`data/resorts.json`:** Complete DVC resort metadata. Include all 17 resorts (14 original + 3 restricted):
```json
[
  {
    "slug": "aulani",
    "name": "Aulani, Disney Vacation Club Villas",
    "short_name": "Aulani",
    "location": "Ko Olina, Hawaii",
    "restricted": false,
    "room_types": ["deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa"],
    "view_categories": ["standard", "island_gardens", "ocean"]
  },
  {
    "slug": "animal_kingdom_jambo",
    "name": "Disney's Animal Kingdom Villas - Jambo House",
    "short_name": "AKL Jambo",
    "location": "Walt Disney World",
    "restricted": false,
    "room_types": ["studio_value", "deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa"],
    "view_categories": ["standard", "savanna"]
  },
  {
    "slug": "animal_kingdom_kidani",
    "name": "Disney's Animal Kingdom Villas - Kidani Village",
    "short_name": "AKL Kidani",
    "location": "Walt Disney World",
    "restricted": false,
    "room_types": ["deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa"],
    "view_categories": ["standard", "savanna"]
  },
  {
    "slug": "bay_lake_tower",
    "name": "Bay Lake Tower at Disney's Contemporary Resort",
    "short_name": "Bay Lake Tower",
    "location": "Walt Disney World",
    "restricted": false,
    "room_types": ["deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa"],
    "view_categories": ["standard", "lake", "theme_park"]
  },
  {
    "slug": "beach_club",
    "name": "Disney's Beach Club Villas",
    "short_name": "Beach Club",
    "location": "Walt Disney World",
    "restricted": false,
    "room_types": ["deluxe_studio", "one_bedroom", "two_bedroom"],
    "view_categories": ["standard"]
  },
  {
    "slug": "boardwalk",
    "name": "Disney's BoardWalk Villas",
    "short_name": "BoardWalk",
    "location": "Walt Disney World",
    "restricted": false,
    "room_types": ["deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa"],
    "view_categories": ["standard", "preferred"]
  },
  {
    "slug": "wilderness_lodge_boulder_ridge",
    "name": "Boulder Ridge Villas at Disney's Wilderness Lodge",
    "short_name": "Boulder Ridge",
    "location": "Walt Disney World",
    "restricted": false,
    "room_types": ["deluxe_studio", "one_bedroom", "two_bedroom"],
    "view_categories": ["standard"]
  },
  {
    "slug": "wilderness_lodge_copper_creek",
    "name": "Copper Creek Villas & Cabins at Disney's Wilderness Lodge",
    "short_name": "Copper Creek",
    "location": "Walt Disney World",
    "restricted": false,
    "room_types": ["deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa", "cabin"],
    "view_categories": ["standard"]
  },
  {
    "slug": "grand_floridian",
    "name": "Disney's Grand Floridian Resort & Spa Villas",
    "short_name": "Grand Floridian",
    "location": "Walt Disney World",
    "restricted": false,
    "room_types": ["resort_studio", "deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa"],
    "view_categories": ["standard", "lake", "theme_park"]
  },
  {
    "slug": "hilton_head",
    "name": "Disney's Hilton Head Island Resort",
    "short_name": "Hilton Head",
    "location": "Hilton Head Island, SC",
    "restricted": false,
    "room_types": ["deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa"],
    "view_categories": ["standard"]
  },
  {
    "slug": "old_key_west",
    "name": "Disney's Old Key West Resort",
    "short_name": "Old Key West",
    "location": "Walt Disney World",
    "restricted": false,
    "room_types": ["deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa"],
    "view_categories": ["standard"]
  },
  {
    "slug": "polynesian",
    "name": "Disney's Polynesian Villas & Bungalows",
    "short_name": "Polynesian",
    "location": "Walt Disney World",
    "restricted": false,
    "room_types": ["deluxe_studio", "one_bedroom", "two_bedroom", "bungalow"],
    "view_categories": ["standard", "lake", "theme_park"]
  },
  {
    "slug": "saratoga_springs",
    "name": "Disney's Saratoga Springs Resort & Spa",
    "short_name": "Saratoga Springs",
    "location": "Walt Disney World",
    "restricted": false,
    "room_types": ["deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa", "treehouse"],
    "view_categories": ["standard", "preferred"]
  },
  {
    "slug": "vero_beach",
    "name": "Disney's Vero Beach Resort",
    "short_name": "Vero Beach",
    "location": "Vero Beach, FL",
    "restricted": false,
    "room_types": ["deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa"],
    "view_categories": ["standard"]
  },
  {
    "slug": "riviera",
    "name": "Disney's Riviera Resort",
    "short_name": "Riviera",
    "location": "Walt Disney World",
    "restricted": true,
    "room_types": ["tower_studio", "deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa"],
    "view_categories": ["standard", "preferred"]
  },
  {
    "slug": "disneyland_hotel",
    "name": "The Villas at Disneyland Hotel",
    "short_name": "Disneyland Hotel",
    "location": "Disneyland Resort",
    "restricted": true,
    "room_types": ["tower_studio", "deluxe_studio", "one_bedroom", "two_bedroom", "grand_villa"],
    "view_categories": ["standard", "preferred", "premium"]
  },
  {
    "slug": "cabins_fort_wilderness",
    "name": "Cabins at Disney's Fort Wilderness Resort",
    "short_name": "Fort Wilderness Cabins",
    "location": "Walt Disney World",
    "restricted": true,
    "room_types": ["cabin"],
    "view_categories": ["standard"]
  }
]
```

Note: Room types and view categories vary significantly per resort. Some like Grand Floridian have resort_studio (smaller than deluxe_studio). Some like Saratoga have treehouses. Some like Riviera have tower studios. This data drives the point chart schema in Plan 01-03.

**`backend/data/resorts.py`:** Load and expose resort data:
```python
import json
from pathlib import Path
from functools import lru_cache

RESORTS_FILE = Path(__file__).parent.parent.parent / "data" / "resorts.json"

@lru_cache
def load_resorts() -> list[dict]:
    with open(RESORTS_FILE) as f:
        return json.load(f)

def get_resort_by_slug(slug: str) -> dict | None:
    return next((r for r in load_resorts() if r["slug"] == slug), None)

def get_resort_slugs() -> list[str]:
    return [r["slug"] for r in load_resorts()]

def get_restricted_resort_slugs() -> list[str]:
    return [r["slug"] for r in load_resorts() if r["restricted"]]

def get_original_resort_slugs() -> list[str]:
    return [r["slug"] for r in load_resorts() if not r["restricted"]]
```

**`backend/api/contracts.py`:** Create an empty FastAPI APIRouter with prefix `/api/contracts` and tag "contracts". Add a placeholder GET `/` that returns `[]`. This will be fully implemented in Plan 01-02.

**`backend/api/points.py`:** Create an empty FastAPI APIRouter with prefix `/api/points` and tag "points". Add a placeholder GET `/` that returns `[]`. This will be fully implemented in Plan 01-02.

Wire both routers into `backend/main.py` via `app.include_router(...)`.

Also add a `GET /api/resorts` endpoint in `main.py` (or a separate `backend/api/resorts.py`) that returns the resort data from `data/resorts.json`, using `backend/data/resorts.py`.

**Alembic migration:** Run `alembic revision --autogenerate -m "initial_schema"` to create the first migration with the contracts and point_balances tables. Verify the migration applies cleanly with `alembic upgrade head`.

**`tests/conftest.py`:** Set up an in-memory SQLite test database:
```python
import pytest
import asyncio
from sqlalchemy.ext.asyncio import create_async_engine, async_sessionmaker, AsyncSession
from backend.db.database import Base
from backend.models import Contract, PointBalance

@pytest.fixture(scope="session")
def event_loop():
    loop = asyncio.new_event_loop()
    yield loop
    loop.close()

@pytest.fixture
async def db_session():
    engine = create_async_engine("sqlite+aiosqlite:///:memory:")
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)
    session_factory = async_sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)
    async with session_factory() as session:
        yield session
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.drop_all)
    await engine.dispose()
```

**`tests/test_models.py`:** Test that models can be created and queried:
- Create a Contract with home_resort="polynesian", use_year_month=6, annual_points=160, purchase_type="resale"
- Verify all fields persist correctly
- Create a PointBalance linked to the contract (use_year=2026, allocation_type="current", points=160)
- Verify the relationship works (contract.point_balances returns the balance)
- Test cascade delete (deleting contract removes its point_balances)
- Test that UseYearMonth enum only allows valid months (2,3,4,6,8,9,10,12)

**`tests/test_use_year.py`:** Test use year date math:
- `get_use_year_start(6, 2026)` returns `date(2026, 6, 1)`
- `get_use_year_end(6, 2026)` returns `date(2027, 5, 31)`
- `get_banking_deadline(6, 2026)` returns `date(2027, 1, 31)` (8 months into June UY = end of January)
- `get_use_year_start(12, 2025)` returns `date(2025, 12, 1)`
- `get_use_year_end(12, 2025)` returns `date(2026, 11, 30)`
- `get_banking_deadline(12, 2025)` returns `date(2026, 7, 31)` (8 months into Dec UY = end of July)
- Test February use year: start Feb 1, end Jan 31 next year, banking deadline Sep 30

## Verification

1. **Backend starts:**
   ```bash
   cd backend && pip install -r requirements.txt && cd ..
   uvicorn backend.main:app --reload
   # GET http://localhost:8000/api/health -> {"status": "ok", "version": "0.1.0"}
   # GET http://localhost:8000/api/resorts -> returns 17 resorts JSON
   ```

2. **Frontend starts:**
   ```bash
   cd frontend && npm install && npm run dev
   # Visit http://localhost:5173 -> shows Layout with sidebar, "Contracts" page placeholder
   # Navigation between /contracts and /point-charts works
   ```

3. **Database migrations:**
   ```bash
   alembic upgrade head  # creates dvc.db with contracts and point_balances tables
   alembic downgrade base  # cleanly removes tables
   ```

4. **Tests pass:**
   ```bash
   pytest tests/ -v
   # test_models.py: contract CRUD, point balance CRUD, relationship, cascade delete
   # test_use_year.py: all use year date math cases pass
   ```

5. **API docs:** Visit `http://localhost:8000/docs` -- Swagger UI shows health, resorts, contracts (stub), and points (stub) endpoints.

## Notes

- The backend uses `sqlite+aiosqlite:///./dvc.db` by default. The DB file is in `.gitignore`.
- Alembic is configured for async migrations to match the async SQLAlchemy engine.
- The `data/resorts.json` file is the single source of truth for resort metadata. Both backend and frontend will reference it (backend loads it directly, frontend gets it via API).
- Room types and view categories in `resorts.json` deliberately vary per resort -- this is accurate to real DVC. Polynesian has "bungalow", Saratoga has "treehouse", Riviera has "tower_studio", etc. The point chart schema in Plan 01-03 must handle this variation.
- The `UseYearMonth` enum enforces that only the 8 valid DVC use year months are used. Validation will be added at the Pydantic layer in Plan 01-02.
- Borrowing percentage is NOT hardcoded yet -- it will be made configurable per STATE.md requirement when the calculation engine is built (Phase 2).
- The scraper layer is intentionally absent -- scraping is deferred to v2 per project decisions.
