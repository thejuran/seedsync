---
phase: 10-lint-cleanup
plan: 04
type: execute
wave: 2
depends_on: ["10-01", "10-02", "10-03"]
files_modified:
  - src/angular/src/app/common/capitalize.pipe.ts
  - src/angular/src/app/common/click-stop-propagation.directive.ts
  - src/angular/src/app/pages/about/about-page.component.ts
  - src/angular/src/app/pages/files/file-list.component.ts
  - src/angular/src/app/pages/files/file-options.component.ts
  - src/angular/src/app/pages/settings/option.component.ts
  - src/angular/src/app/pages/settings/settings-page.component.ts
  - src/angular/src/app/routes.ts
  - src/angular/src/app/services/files/view-file.ts
  - src/angular/src/app/services/logs/log-record.ts
  - src/angular/src/app/services/settings/config.service.ts
  - src/angular/src/app/services/utils/local-storage.service.ts
  - src/angular/src/app/services/utils/notification.ts
  - src/angular/src/app/services/utils/version-check.service.ts
  - src/angular/src/app/tests/mocks/mock-event-source.ts
  - src/angular/src/app/tests/unittests/common/is-selected.pipe.spec.ts
  - src/angular/src/app/tests/unittests/pages/files/bulk-actions-bar.component.spec.ts
  - src/angular/src/app/tests/unittests/pages/files/file.component.spec.ts
  - src/angular/src/app/tests/unittests/services/files/view-file.service.spec.ts
  - src/angular/src/app/tests/unittests/services/server/bulk-command.service.spec.ts
  - src/angular/src/app/tests/unittests/services/utils/version-check.service.spec.ts
autonomous: true

must_haves:
  truths:
    - "No `any` types remain in application code"
    - "No non-null assertions (`!`) remain without proper guards"
    - "All Bootstrap references use proper types"
    - "All enum casts removed (direct string literals used)"
  artifacts:
    - path: "src/angular/src/app/pages/files/file-options.component.ts"
      provides: "Bootstrap Modal/Dropdown with proper types"
      contains: "Modal.getInstance"
    - path: "src/angular/src/app/services/files/view-file.ts"
      provides: "String enum without any casts"
      contains: "Status ="
    - path: "src/angular/src/app/pages/files/file-list.component.ts"
      provides: "Safe null handling with optional chaining"
      contains: "?."
  key_links:
    - from: "src/angular/src/app/pages/files/file-options.component.ts"
      to: "bootstrap"
      via: "Bootstrap Modal/Dropdown types"
      pattern: "Modal|Dropdown"
---

<objective>
Replace all `any` types with proper TypeScript types and remove all non-null assertions by using optional chaining and proper null guards.

Purpose: Achieve full type safety across the codebase. The `any` type bypasses TypeScript's type checking, and non-null assertions (`!`) can cause runtime errors. This plan eliminates both patterns.

Output: 96 lint issues resolved (49 `any` types + 47 non-null assertions), achieving zero lint errors/warnings.
</objective>

<execution_context>
@/Users/julianamacbook/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianamacbook/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-lint-cleanup/10-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace `any` types in application code</name>
  <files>
src/angular/src/app/common/capitalize.pipe.ts
src/angular/src/app/common/click-stop-propagation.directive.ts
src/angular/src/app/pages/about/about-page.component.ts
src/angular/src/app/pages/files/file-options.component.ts
src/angular/src/app/pages/settings/option.component.ts
src/angular/src/app/pages/settings/settings-page.component.ts
src/angular/src/app/routes.ts
src/angular/src/app/services/files/view-file.ts
src/angular/src/app/services/logs/log-record.ts
src/angular/src/app/services/settings/config.service.ts
src/angular/src/app/services/utils/local-storage.service.ts
src/angular/src/app/services/utils/notification.ts
src/angular/src/app/services/utils/version-check.service.ts
  </files>
  <action>
Replace `any` with proper types following these patterns:

**1. Bootstrap declaration (file-options.component.ts line 15):**
```typescript
// Before
declare var bootstrap: any;

// After - use direct Bootstrap imports
import { Modal, Dropdown } from 'bootstrap';

// Then use Modal.getInstance(), new Dropdown(), etc.
// OR if imports don't work, use typed global:
declare const bootstrap: {
    Modal: typeof import('bootstrap').Modal;
    Dropdown: typeof import('bootstrap').Dropdown;
};
```

**2. Pipe transform (capitalize.pipe.ts line 6):**
```typescript
// Before
transform(value: any): string {

// After
transform(value: string | null | undefined): string {
```

**3. Event handlers (click-stop-propagation.directive.ts line 9):**
```typescript
// Before
onClick(event: any): void {

// After
onClick(event: Event): void {
```

**4. Route data (routes.ts line 15):**
```typescript
// Before
data: any

// After - create proper route data interface
interface RouteData {
    title?: string;
    // other properties
}
data: RouteData
```

**5. String enums (view-file.ts, log-record.ts):**
```typescript
// Before - enum with <any> casts
export enum Status {
    DEFAULT = <any>"default",
    QUEUED = <any>"queued"
}

// After - direct string literals (TypeScript 2.4+)
export enum Status {
    DEFAULT = "default",
    QUEUED = "queued"
}
```

**6. Config/Settings (option.component.ts, settings-page.component.ts, config.service.ts):**
```typescript
// Before
value: any

// After - use actual config type or generic
value: string | number | boolean
// OR
value: ConfigValue  // Define type alias
```

**7. Local storage (local-storage.service.ts):**
```typescript
// Before
get(key: string): any

// After - use generic
get<T>(key: string): T | null
// OR
get(key: string): string | null  // localStorage only stores strings
```

**8. Notification data (notification.ts):**
```typescript
// Before
data: any

// After
data: unknown  // Or specific notification data interface
```

**9. Version check (version-check.service.ts):**
```typescript
// Before
response: any

// After
interface VersionResponse {
    version: string;
    // other fields
}
response: VersionResponse
```

**10. About page (about-page.component.ts):**
Check what `any` is used for and replace with appropriate type.
  </action>
  <verify>
```bash
cd src/angular && npm run lint 2>&1 | grep -v "/tests/" | grep "no-explicit-any"
# Should return empty (no any in app code)
```
  </verify>
  <done>All `any` types in application code replaced with proper types.</done>
</task>

<task type="auto">
  <name>Task 2: Replace `any` types in test code</name>
  <files>
src/angular/src/app/tests/mocks/mock-event-source.ts
src/angular/src/app/tests/unittests/common/is-selected.pipe.spec.ts
src/angular/src/app/tests/unittests/pages/files/bulk-actions-bar.component.spec.ts
src/angular/src/app/tests/unittests/pages/files/file.component.spec.ts
src/angular/src/app/tests/unittests/services/files/view-file.service.spec.ts
src/angular/src/app/tests/unittests/services/utils/version-check.service.spec.ts
  </files>
  <action>
Replace `any` types in test files:

**mock-event-source.ts:**
```typescript
// Before
onmessage: any

// After
onmessage: ((event: MessageEvent) => void) | null
```

**Test spec files:**
```typescript
// Before - spy casting
const spy = jasmine.createSpy() as any;

// After - proper spy typing
const spy = jasmine.createSpy() as jasmine.Spy;

// Before - mock object
const mockService: any = { }

// After - partial mock with proper type
const mockService = jasmine.createSpyObj<MyService>('MyService', ['method1', 'method2']);
// OR
const mockService: Partial<MyService> = { }
```

For Jasmine spyOn patterns:
```typescript
// Before
spyOn(service, 'method').and.returnValue(x as any);

// After
spyOn(service, 'method').and.returnValue(x);  // Let TypeScript infer
// OR
spyOn(service, 'method').and.returnValue(x as ReturnType<typeof service.method>);
```
  </action>
  <verify>
```bash
cd src/angular && npm run lint 2>&1 | grep "no-explicit-any"
# Should return empty (no any in tests either)
```
  </verify>
  <done>All `any` types in test code replaced with proper types.</done>
</task>

<task type="auto">
  <name>Task 3: Fix non-null assertions</name>
  <files>
src/angular/src/app/pages/files/file-list.component.ts
src/angular/src/app/tests/unittests/services/server/bulk-command.service.spec.ts
  </files>
  <action>
Replace non-null assertions (`!`) with safe null handling:

**file-list.component.ts (3 assertions at lines 448, 455, 456):**

Pattern 1 - Use optional chaining:
```typescript
// Before
const value = object.property!.method();

// After
const value = object.property?.method() ?? defaultValue;
```

Pattern 2 - Early return guard:
```typescript
// Before
processFile(this.selectedFile!);

// After
if (!this.selectedFile) return;
processFile(this.selectedFile);  // TypeScript knows it's non-null
```

Pattern 3 - Nullish coalescing:
```typescript
// Before
const name = file!.name;

// After
const name = file?.name ?? 'Unknown';
```

**bulk-command.service.spec.ts (44 assertions!):**

This test file has extensive non-null assertions, likely in test assertions or mock setups.

Common test patterns to fix:
```typescript
// Before - accessing array elements
expect(result[0]!.name).toBe('expected');

// After - with proper guard
expect(result[0]?.name).toBe('expected');
// OR if array should definitely have elements:
const first = result[0];
expect(first).toBeDefined();
expect(first?.name).toBe('expected');

// Before - accessing mock return values
const response = spy.calls.mostRecent().returnValue!;

// After
const response = spy.calls.mostRecent()?.returnValue;
expect(response).toBeDefined();
```

For repeated patterns in test file:
- Look for common assertion patterns and fix systematically
- Many may be array access like `items[0]!` - use `items[0]?` or add guards
- Mock return values - add null checks or use optional chaining

Important: Understand WHY non-null was used before changing:
- If code SHOULD fail when null, use explicit guard with error
- If null is acceptable, use optional chaining with default
- In tests, usually prefer optional chaining since test will fail anyway if undefined
  </action>
  <verify>
```bash
cd src/angular && npm run lint 2>&1 | grep "no-non-null-assertion"
# Should return empty (no non-null assertions)
```
  </verify>
  <done>All 47 non-null assertions replaced with safe null handling.</done>
</task>

</tasks>

<verification>
```bash
# Verify all any types fixed
cd src/angular && npm run lint 2>&1 | grep "no-explicit-any"
# Expected: No output

# Verify all non-null assertions fixed
cd src/angular && npm run lint 2>&1 | grep "no-non-null-assertion"
# Expected: No output

# Verify zero total lint issues
cd src/angular && npm run lint
# Expected: No errors, no warnings - clean exit

# Run full test suite
cd src/angular && npm test -- --watch=false
# Expected: All 387 tests pass

# Verify app still works
cd src/angular && ng build --configuration=production
# Expected: Build succeeds
```
</verification>

<success_criteria>
1. Zero `no-explicit-any` warnings (LINT-02 complete)
2. Zero `no-non-null-assertion` errors (LINT-03 complete)
3. `npm run lint` exits with zero errors and zero warnings (LINT-06 complete)
4. All 387 unit tests pass
5. Production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/10-lint-cleanup/10-04-SUMMARY.md`
</output>
