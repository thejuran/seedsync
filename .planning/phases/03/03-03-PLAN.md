---
phase: 03-dashboard-trip-explorer
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - frontend/src/pages/TripExplorerPage.tsx
  - frontend/src/components/TripExplorerForm.tsx
  - frontend/src/components/TripExplorerResults.tsx
  - frontend/src/hooks/useTripExplorer.ts
  - frontend/src/types/index.ts
  - frontend/src/App.tsx
  - frontend/src/components/Layout.tsx
autonomous: false
user_setup: []

must_haves:
  truths:
    - "User can enter check-in and check-out dates and see all affordable resort/room options"
    - "Results show contract name, resort, room type, point cost, and points remaining"
    - "User sees which resorts were checked vs skipped due to missing chart data"
    - "Dashboard is the landing page (root / redirects to /dashboard)"
    - "Navigation includes Dashboard as first item and Trip Explorer as second item"
    - "Existing pages (Contracts, Reservations, Point Charts) remain accessible via updated nav"
  artifacts:
    - path: "frontend/src/pages/TripExplorerPage.tsx"
      provides: "Trip Explorer page with date form and results display"
      min_lines: 40
    - path: "frontend/src/components/TripExplorerForm.tsx"
      provides: "Date range input form for trip explorer"
      min_lines: 15
    - path: "frontend/src/components/TripExplorerResults.tsx"
      provides: "Affordable options display with coverage info"
      min_lines: 30
    - path: "frontend/src/hooks/useTripExplorer.ts"
      provides: "TanStack Query hook for /api/trip-explorer endpoint"
      exports: ["useTripExplorer"]
    - path: "frontend/src/types/index.ts"
      provides: "TripExplorerOption and TripExplorerResponse TypeScript types"
      contains: "TripExplorerResponse"
    - path: "frontend/src/App.tsx"
      provides: "Routes for /dashboard and /trip-explorer, root redirect to /dashboard"
      contains: "DashboardPage"
    - path: "frontend/src/components/Layout.tsx"
      provides: "Updated nav with Dashboard, Trip Explorer, Contracts, Reservations, Point Charts"
      contains: "Trip Explorer"
  key_links:
    - from: "frontend/src/hooks/useTripExplorer.ts"
      to: "/api/trip-explorer"
      via: "api.get() call with check_in and check_out params"
      pattern: "api\\.get.*trip-explorer"
    - from: "frontend/src/pages/TripExplorerPage.tsx"
      to: "frontend/src/hooks/useTripExplorer.ts"
      via: "useTripExplorer(checkIn, checkOut) hook call"
      pattern: "useTripExplorer"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/DashboardPage.tsx"
      via: "Route element for /dashboard path"
      pattern: "path.*dashboard.*DashboardPage"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/TripExplorerPage.tsx"
      via: "Route element for /trip-explorer path"
      pattern: "path.*trip-explorer.*TripExplorerPage"
---

<objective>
Build the Trip Explorer frontend page and update navigation so Dashboard is the landing page, completing all Phase 3 UI work.

Purpose: Connects the Trip Explorer backend (Plan 01) to a user-facing UI, and wires up the Dashboard page (Plan 02) into the app's routing and navigation. This completes requirements TRIP-02, DASH-01, and DASH-02.

Output: Working Trip Explorer page with date range form and results display. Updated navigation with Dashboard as home page and Trip Explorer as a new nav item.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03/03-RESEARCH.md
@.planning/phases/03/03-01-SUMMARY.md
@.planning/phases/03/03-02-SUMMARY.md

@frontend/src/App.tsx
@frontend/src/components/Layout.tsx
@frontend/src/types/index.ts
@frontend/src/hooks/useAvailability.ts
@frontend/src/lib/api.ts
@frontend/src/lib/utils.ts
@frontend/src/pages/AvailabilityPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Trip Explorer types, hook, and page components</name>
  <files>frontend/src/types/index.ts, frontend/src/hooks/useTripExplorer.ts, frontend/src/components/TripExplorerForm.tsx, frontend/src/components/TripExplorerResults.tsx, frontend/src/pages/TripExplorerPage.tsx</files>
  <action>
**Step 1: Add TypeScript types to `frontend/src/types/index.ts`.**

Append to the end of the file:

```typescript
// Trip Explorer types

export interface TripExplorerOption {
  contract_id: number;
  contract_name: string;
  available_points: number;
  resort: string;
  resort_name: string;
  room_key: string;
  total_points: number;
  num_nights: number;
  points_remaining: number;
  nightly_avg: number;
}

export interface TripExplorerResponse {
  check_in: string;
  check_out: string;
  num_nights: number;
  options: TripExplorerOption[];
  resorts_checked: string[];
  resorts_skipped: string[];
  total_options: number;
}
```

**Step 2: Create `frontend/src/hooks/useTripExplorer.ts`.**

Follow the exact pattern of `useAvailability.ts`:

```typescript
import { useQuery } from "@tanstack/react-query";
import { api } from "../lib/api";
import type { TripExplorerResponse } from "../types";

export function useTripExplorer(checkIn: string | null, checkOut: string | null) {
  return useQuery({
    queryKey: ["trip-explorer", checkIn, checkOut],
    queryFn: () =>
      api.get<TripExplorerResponse>(
        `/trip-explorer?check_in=${checkIn}&check_out=${checkOut}`
      ),
    enabled: !!checkIn && !!checkOut,
  });
}
```

**Step 3: Create `frontend/src/components/TripExplorerForm.tsx`.**

Props: `{ checkIn: string; checkOut: string; onCheckInChange: (v: string) => void; onCheckOutChange: (v: string) => void; isLoading: boolean }`

Simple form with:
- Two date inputs (Input from `@/components/ui/input`, Label from `@/components/ui/label`) side by side in a flex row (`flex gap-4 items-end`):
  - "Check-in" label + date input
  - "Check-out" label + date input
- Each input is `className="w-48"` with `type="date"`
- Below the inputs, if `isLoading`, show a subtle "Searching..." text in text-muted-foreground

The parent page controls state and passes handlers. The form is stateless (controlled inputs).

**Step 4: Create `frontend/src/components/TripExplorerResults.tsx`.**

Props: `{ data: TripExplorerResponse }`

Import: `parseRoomKey` from `../lib/utils`, Card/CardContent from `@/components/ui/card`, Badge from `@/components/ui/badge`.

Structure:
1. **Coverage info banner** -- Always shown at the top:
   - If `data.resorts_skipped.length > 0`: Show a note in a subtle card (bg-muted/50 border rounded-lg p-3 text-sm):
     "Checked {data.resorts_checked.length} resort(s). {data.resorts_skipped.length} eligible resort(s) skipped -- no point chart data available."
     Below that, in text-xs text-muted-foreground: "Skipped: {data.resorts_skipped.join(', ').replace(/_/g, ' ')}"
   - If all resorts checked: "Checked all {data.resorts_checked.length} eligible resort(s)."

2. **Results summary**: "{data.total_options} affordable option(s) for {data.num_nights} night(s)"

3. **Results list**: If `data.options.length === 0`, show "No affordable options found for these dates." in a centered empty state.

   Otherwise, render results as a responsive grid of Cards (`grid gap-3 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3`). Each card:
   - Resort name: `option.resort_name` in font-semibold
   - Room info: Use `parseRoomKey(option.room_key)` to display room type and view
   - Contract: `option.contract_name` in text-xs text-muted-foreground
   - Cost: `option.total_points` pts in text-lg font-bold, with `({option.nightly_avg} pts/night)` in text-xs
   - Remaining: Badge showing `{option.points_remaining} pts remaining` -- use `variant="secondary"` with green color if remaining >= 50% of available_points, amber if < 50%

**Step 5: Create `frontend/src/pages/TripExplorerPage.tsx`.**

Uses `useState` for `checkIn` (default: empty string) and `checkOut` (default: empty string).
Uses `useTripExplorer(checkIn || null, checkOut || null)`.

Structure:
- Header: `<h2>Trip Explorer</h2>` + subtitle "Find what you can afford for a date range"
- `<TripExplorerForm>` with state handlers and isLoading
- Error state: if query has error, show message in text-destructive
- Results: if `data` exists, render `<TripExplorerResults data={data} />`
- When both dates are empty (initial state), show a helpful prompt: "Select check-in and check-out dates to see what you can book."

**Do NOT:**
- Add resort/room type filters to the form. The trip explorer shows ALL affordable options. Filtering is a v2 feature.
- Make the form a separate page or modal. It's inline at the top of the page.
- Add "Search" button. The query fires automatically when both dates are filled (enabled flag on useQuery handles this).
  </action>
  <verify>
```bash
cd /Users/julianamacbook/dvc && npx tsc --noEmit
```
TypeScript compiles with no errors. All new files exist and import correctly.
  </verify>
  <done>
Trip Explorer types, hook, form, results, and page components all created. Hook follows existing useAvailability pattern. Results clearly show resort coverage info and affordable options as cards.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update routing and navigation</name>
  <files>frontend/src/App.tsx, frontend/src/components/Layout.tsx</files>
  <action>
**Step 1: Update `frontend/src/App.tsx`.**

Add imports for DashboardPage and TripExplorerPage:
```typescript
import DashboardPage from "./pages/DashboardPage";
import TripExplorerPage from "./pages/TripExplorerPage";
```

Update Routes:
- Change the root redirect from `/contracts` to `/dashboard`:
  `<Route path="/" element={<Navigate to="/dashboard" replace />} />`
- Add dashboard route: `<Route path="/dashboard" element={<DashboardPage />} />`
- Add trip explorer route: `<Route path="/trip-explorer" element={<TripExplorerPage />} />`
- Keep all existing routes (/contracts, /availability, /reservations, /point-charts) exactly as they are

**Step 2: Update `frontend/src/components/Layout.tsx`.**

Update the `navItems` array to:
```typescript
const navItems = [
  { to: "/dashboard", label: "Dashboard" },
  { to: "/trip-explorer", label: "Trip Explorer" },
  { to: "/contracts", label: "Contracts" },
  { to: "/availability", label: "Availability" },
  { to: "/reservations", label: "Reservations" },
  { to: "/point-charts", label: "Point Charts" },
];
```

Note: "Point Calculator" is renamed to "Availability" to avoid confusion with the Trip Explorer. The route path `/availability` remains the same -- only the nav label changes.

**Do NOT:**
- Remove the Availability page or route. It remains useful for checking point availability for a specific date without the trip explorer context.
- Change the Layout component structure, styling, or sidebar behavior. Only the navItems array changes.
  </action>
  <verify>
Start the dev server and verify:
```bash
cd /Users/julianamacbook/dvc && npx tsc --noEmit
```

Then manually verify (or via curl if backend running):
1. TypeScript compiles clean
2. App.tsx has 6 routes: /, /dashboard, /trip-explorer, /contracts, /availability, /reservations, /point-charts
3. Layout.tsx navItems has 6 items: Dashboard, Trip Explorer, Contracts, Availability, Reservations, Point Charts
  </verify>
  <done>
Root route redirects to /dashboard. Dashboard and Trip Explorer have routes. Navigation updated with Dashboard first, Trip Explorer second, and "Point Calculator" renamed to "Availability". All existing routes preserved.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify complete Phase 3 UI</name>
  <files>N/A -- visual verification only</files>
  <action>
Human verifies complete Phase 3 flow.

**What was built:** Dashboard home page with summary cards, urgent alerts, and upcoming reservations. Trip Explorer page with date range search showing affordable resort/room options. Updated navigation with Dashboard as landing page.

**How to verify:**
1. Start both servers: `uvicorn backend.main:app --port 8000` and `cd frontend && npm run dev`
2. Open http://localhost:5173 -- should redirect to /dashboard
3. Dashboard should show: 4 summary cards (Contracts, Total Points, Available Points, Committed), urgent alerts section (if any contracts have banking deadlines within 60 days or expirations within 90 days), upcoming reservations list
4. Click "Trip Explorer" in sidebar nav
5. Enter check-in and check-out dates (e.g., a few weeks from now, 3-night stay)
6. Results should appear automatically showing coverage info (how many resorts checked vs skipped) and affordable options as cards with resort name, room type, point cost, and remaining points
7. Verify sidebar nav has all 6 items: Dashboard, Trip Explorer, Contracts, Availability, Reservations, Point Charts
8. Click through each nav item to verify all pages still work
  </action>
  <verify>User types "approved" or describes issues to fix</verify>
  <done>User confirms Dashboard and Trip Explorer pages work correctly, navigation is updated, and all existing pages remain functional.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no type errors
2. Root route (/) redirects to /dashboard
3. Dashboard shows summary cards, urgency alerts, upcoming reservations
4. Trip Explorer accepts dates and shows affordable options from backend API
5. Trip Explorer shows resort coverage info (checked vs skipped)
6. Navigation updated: Dashboard (home), Trip Explorer, Contracts, Availability, Reservations, Point Charts
7. All existing pages still accessible and functional
8. Human visual verification of complete flow
</verification>

<success_criteria>
- Trip Explorer page shows affordable options based on backend search results
- Results clearly communicate which resorts were checked vs skipped
- Dashboard is the app landing page
- Navigation restructured with all 6 items
- "Point Calculator" renamed to "Availability" in nav
- All existing pages remain functional
- User approves the visual/functional experience
</success_criteria>

<output>
After completion, create `.planning/phases/03/03-03-SUMMARY.md`
</output>
