---
phase: 31-theme-toggle-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/angular/src/app/pages/settings/settings-page.component.ts
  - src/angular/src/app/pages/settings/settings-page.component.html
  - src/angular/src/app/pages/settings/settings-page.component.scss
  - src/angular/src/app/tests/unittests/pages/settings/settings-page-theme.spec.ts
autonomous: true

must_haves:
  truths:
    - "User can select between Light, Dark, and Auto theme modes in Settings > Appearance section"
    - "Selecting a mode immediately applies the theme via ThemeService"
    - "Settings page shows current active theme mode with visual indicator (active button + status text)"
    - "When Auto is selected, status text shows which theme it currently resolves to"
    - "Theme toggle is accessible (aria-pressed, aria-label, aria-hidden on icons)"
  artifacts:
    - path: "src/angular/src/app/pages/settings/settings-page.component.ts"
      provides: "ThemeService injection and theme signal exposure"
      contains: "ThemeService"
    - path: "src/angular/src/app/pages/settings/settings-page.component.html"
      provides: "Appearance accordion section with button group"
      contains: "theme-toggle"
    - path: "src/angular/src/app/pages/settings/settings-page.component.scss"
      provides: "Theme toggle styling"
      contains: "theme-toggle"
    - path: "src/angular/src/app/tests/unittests/pages/settings/settings-page-theme.spec.ts"
      provides: "Unit tests for theme toggle"
      contains: "describe"
  key_links:
    - from: "src/angular/src/app/pages/settings/settings-page.component.ts"
      to: "src/angular/src/app/services/theme/theme.service.ts"
      via: "inject(ThemeService)"
      pattern: "inject\\(ThemeService\\)"
    - from: "src/angular/src/app/pages/settings/settings-page.component.html"
      to: "settings-page.component.ts"
      via: "template signal binding"
      pattern: "theme\\(\\)|resolvedTheme\\(\\)|onSetTheme"
---

<objective>
Add theme toggle UI to Settings page so users can select between Light, Dark, and Auto theme modes.

Purpose: Completes the user-facing theme control (UI-01, UI-02). ThemeService (Phase 29) and theme-aware CSS (Phase 30) are already done -- this is purely presentational binding.
Output: Appearance section in Settings with working theme toggle, plus unit tests.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-theme-toggle-ui/31-RESEARCH.md
@src/angular/src/app/pages/settings/settings-page.component.ts
@src/angular/src/app/pages/settings/settings-page.component.html
@src/angular/src/app/pages/settings/settings-page.component.scss
@src/angular/src/app/services/theme/theme.service.ts
@src/angular/src/app/services/theme/theme.types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Appearance section with theme toggle to Settings page</name>
  <files>
    src/angular/src/app/pages/settings/settings-page.component.ts
    src/angular/src/app/pages/settings/settings-page.component.html
    src/angular/src/app/pages/settings/settings-page.component.scss
  </files>
  <action>
    **settings-page.component.ts changes:**
    1. Import `inject` from `@angular/core` (add to existing import)
    2. Import `ThemeService` from `../../services/theme/theme.service`
    3. Import `ThemeMode` from `../../services/theme/theme.types`
    4. Add private field: `private _themeService = inject(ThemeService);`
    5. Add public signal accessors:
       - `public theme = this._themeService.theme;`
       - `public resolvedTheme = this._themeService.resolvedTheme;`
    6. Add method: `onSetTheme(mode: ThemeMode): void { this._themeService.setTheme(mode); }`

    NOTE: The component uses OnPush change detection. Signal reads in the template (`theme()`, `resolvedTheme()`) are automatically tracked by Angular 19, so no manual `markForCheck()` is needed for theme changes.

    **settings-page.component.html changes:**
    Add an Appearance card section in the `#right` div, AFTER the existing "Other" section (`OPTIONS_CONTEXT_OTHER`). Use the same card/accordion pattern as the existing sections but with custom content (not the `optionsList` template, since this is a button group, not option components).

    The Appearance section structure:
    - Card with accordion header "Appearance" (id: `heading-appearance`, collapse target: `collapse-appearance`, `data-bs-parent="#accordion"`)
    - Inside card-body: heading "Theme Mode", description text "Choose your preferred color theme."
    - Bootstrap `.btn-group` with `role="group"` and `aria-label="Theme mode selection"`
    - Three `btn btn-outline-secondary` buttons for Light, Dark, Auto
    - Each button has: `[class.active]="theme() === 'light'"` (etc.), `[attr.aria-pressed]="theme() === 'light'"` (etc.), `(click)="onSetTheme('light')"` (etc.)
    - Each button contains an inline SVG icon (16x16, `fill="currentColor"`, `aria-hidden="true"`, class `me-1`) followed by text label
    - SVG paths from research: sun icon for Light, moon icon for Dark, circle-half icon for Auto
    - Below the button group, a `.theme-status.mt-2` div with `<small class="text-muted">` showing: `Current theme: <strong>{{ theme() }}</strong>` and conditionally `@if (theme() === 'auto') { <span>(following system preference: {{ resolvedTheme() }})</span> }`

    Use Angular's new `@if` control flow syntax (not `*ngIf`) for the conditional since this is new code.

    **settings-page.component.scss changes:**
    Add inside the existing `#left, #right` `.card` nesting (after `.webhook-urls` block):

    ```scss
    .theme-toggle {
      .btn {
        min-width: 90px;

        svg {
          vertical-align: text-bottom;
        }
      }

      .btn.active {
        font-weight: 500;
      }
    }

    .theme-status {
      font-size: 0.875rem;

      strong {
        text-transform: capitalize;
      }
    }
    ```

    Also add a responsive rule for very small screens inside the existing mobile styles (inside the `#left, #right` `.card` context):
    ```scss
    @media (max-width: 360px) {
      .theme-toggle {
        flex-direction: column;
        width: 100%;

        .btn {
          width: 100%;
          text-align: left;
        }
      }
    }
    ```
  </action>
  <verify>
    1. `cd /Users/julianamacbook/seedsync/src/angular && node_modules/@angular/cli/bin/ng build` succeeds with no errors
    2. `cd /Users/julianamacbook/seedsync/src/angular && npm run lint` passes with no new errors
    3. Verify the HTML contains `role="group"`, `aria-pressed`, `aria-hidden="true"`, and `aria-label` attributes by reading the file
  </verify>
  <done>
    Settings page has an Appearance accordion section in the right column with a three-button toggle (Light/Dark/Auto), each with SVG icon and text label. Buttons bind to ThemeService signals. Active button shows `.active` class and `aria-pressed="true"`. Status text below shows current theme and resolves auto mode. Build and lint pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add unit tests for Settings page theme toggle</name>
  <files>
    src/angular/src/app/tests/unittests/pages/settings/settings-page-theme.spec.ts
  </files>
  <action>
    Create a focused test file for the theme toggle functionality in the Settings page.

    Follow the existing test pattern from `src/angular/src/app/tests/unittests/services/theme/theme.service.spec.ts` for mock setup style.

    **Test setup:**
    - Create a minimal test module with `SettingsPageComponent`
    - Mock `ThemeService` with: a writable signal for `theme`, a writable signal for `resolvedTheme`, and a jasmine spy for `setTheme`
    - Mock other dependencies that `SettingsPageComponent` requires (LoggerService, StreamServiceRegistry with ConnectedService, ConfigService, NotificationService, ServerCommandService) as minimal stubs (the existing constructor params). Use `jasmine.createSpyObj` or minimal objects that satisfy the constructor.
    - For ConfigService mock: provide an Observable of empty Config (use `of()` or `EMPTY`) since theme tests don't need config data
    - For ConnectedService mock: provide `connected` as `of(true)` Observable

    **Test cases (7-8 tests):**

    1. "should render theme toggle button group" - Query `.btn-group.theme-toggle`, expect it to exist with 3 buttons
    2. "should show Light button as active when theme is light" - Set mock theme signal to 'light', detectChanges, expect Light button has `.active` class and `aria-pressed="true"`, others have `aria-pressed="false"`
    3. "should show Dark button as active when theme is dark" - Set mock theme signal to 'dark', detectChanges, verify Dark button active
    4. "should show Auto button as active when theme is auto" - Set mock theme signal to 'auto', detectChanges, verify Auto button active
    5. "should call setTheme when button clicked" - Click Dark button, expect `mockThemeService.setTheme` called with 'dark'
    6. "should show resolved theme text when auto mode" - Set theme to 'auto', set resolvedTheme to 'dark', detectChanges, expect `.theme-status` contains "following system preference: dark"
    7. "should not show resolved theme text when not auto mode" - Set theme to 'light', detectChanges, expect `.theme-status` does NOT contain "following system preference"
    8. "should have aria-hidden on all SVG icons" - Query all `svg` elements inside `.theme-toggle`, expect each has `aria-hidden="true"`

    **Important notes:**
    - Use `signal()` from `@angular/core` for mock signals (writable, so tests can `.set()` values)
    - Use `TestBed.configureTestingModule` with `imports: [SettingsPageComponent]` (standalone component)
    - Use `overrideComponent` or `TestBed.overrideProvider` to inject mocks
    - Call `fixture.detectChanges()` after signal changes
    - Query DOM elements using `fixture.nativeElement.querySelector` / `querySelectorAll`
    - Add explicit return types to all functions per project conventions (Phase 10 decisions)
  </action>
  <verify>
    1. `cd /Users/julianamacbook/seedsync/src/angular && node_modules/@angular/cli/bin/ng test --watch=false` - all tests pass including new ones
    2. Read the test file and verify it covers all 7-8 test cases listed above
  </verify>
  <done>
    Unit test file exists with 7-8 passing tests covering: button group rendering, active state per theme mode, click handlers calling setTheme, resolved theme status text visibility, and ARIA attributes on icons. All existing tests continue to pass.
  </done>
</task>

</tasks>

<verification>
1. Angular build succeeds: `cd src/angular && node_modules/@angular/cli/bin/ng build`
2. Lint passes: `cd src/angular && npm run lint`
3. All unit tests pass: `cd src/angular && node_modules/@angular/cli/bin/ng test --watch=false`
4. Grep confirms key patterns:
   - `grep -r "ThemeService" src/angular/src/app/pages/settings/settings-page.component.ts` finds injection
   - `grep -r "theme-toggle" src/angular/src/app/pages/settings/settings-page.component.html` finds button group
   - `grep -r "aria-pressed" src/angular/src/app/pages/settings/settings-page.component.html` finds accessibility attrs
   - `grep -r "resolvedTheme" src/angular/src/app/pages/settings/settings-page.component.html` finds status text
</verification>

<success_criteria>
- Settings > Appearance section visible in right column with "Theme Mode" heading
- Three-button toggle (Light/Dark/Auto) with SVG icons renders correctly
- Clicking a button calls ThemeService.setTheme() with correct mode
- Active button shows Bootstrap .active styling
- Status text shows "Current theme: [mode]" and "(following system preference: [resolved])" for auto
- All ARIA attributes present (role="group", aria-label, aria-pressed, aria-hidden)
- 7-8 unit tests pass covering rendering, interaction, and accessibility
- Build, lint, and all existing tests continue to pass
</success_criteria>

<output>
After completion, create `.planning/phases/31-theme-toggle-ui/31-01-SUMMARY.md`
</output>
