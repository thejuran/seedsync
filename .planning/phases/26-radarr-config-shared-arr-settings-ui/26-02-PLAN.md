---
phase: 26-radarr-config-shared-arr-settings-ui
plan: 02
type: execute
wave: 2
depends_on: ["26-01"]
files_modified:
  - src/angular/src/app/services/settings/config.ts
  - src/angular/src/app/services/settings/config.service.ts
  - src/angular/src/app/pages/settings/settings-page.component.ts
  - src/angular/src/app/pages/settings/settings-page.component.html
  - src/angular/src/app/pages/settings/settings-page.component.scss
autonomous: true

must_haves:
  truths:
    - "User can enter Radarr URL and API key in Settings page"
    - "User can enable/disable Radarr integration via toggle"
    - "User can click Test Connection for Radarr and see success/failure"
    - "Sonarr and Radarr share a unified *arr Integration section with subsections"
    - "Existing Sonarr settings continue working unchanged"
    - "Sonarr and Radarr have independent enable toggles and test connection state"
  artifacts:
    - path: "src/angular/src/app/services/settings/config.ts"
      provides: "IRadarr interface, RadarrRecord, IConfig.radarr, Config constructor with backward-compat"
      contains: "IRadarr"
    - path: "src/angular/src/app/services/settings/config.service.ts"
      provides: "testRadarrConnection method calling /server/config/radarr/test-connection"
      contains: "testRadarrConnection"
    - path: "src/angular/src/app/pages/settings/settings-page.component.html"
      provides: "Shared *arr Integration section with Sonarr + Radarr subsections"
      contains: "subsection-header"
    - path: "src/angular/src/app/pages/settings/settings-page.component.ts"
      provides: "testRadarrConnectionLoading, testRadarrConnectionResult, onTestRadarrConnection handler"
      contains: "onTestRadarrConnection"
    - path: "src/angular/src/app/pages/settings/settings-page.component.scss"
      provides: "Subsection header styles"
      contains: "subsection-header"
  key_links:
    - from: "src/angular/src/app/pages/settings/settings-page.component.ts"
      to: "src/angular/src/app/services/settings/config.service.ts"
      via: "this._configService.testRadarrConnection()"
      pattern: "_configService\\.testRadarrConnection"
    - from: "src/angular/src/app/services/settings/config.service.ts"
      to: "/server/config/radarr/test-connection"
      via: "REST sendRequest"
      pattern: "RADARR_TEST_URL"
    - from: "src/angular/src/app/pages/settings/settings-page.component.html"
      to: "src/angular/src/app/services/settings/config.ts"
      via: "config async pipe accessing radarr Record properties"
      pattern: "get\\('radarr'\\)"
---

<objective>
Add IRadarr frontend model, testRadarrConnection service method, and refactor the *arr Integration Settings UI into a unified section with Sonarr and Radarr subsections. Each subsection has independent enable toggle, URL, API key, and Test Connection.

Purpose: Users can configure Radarr alongside Sonarr in a single, organized *arr Integration section. Satisfies RAD-01, RAD-02, RAD-03, ARR-01, ARR-02.
Output: Updated config model, config service, settings page component (TS, HTML, SCSS).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-radarr-config-shared-arr-settings-ui/26-RESEARCH.md
@.planning/phases/22-configuration-settings-ui/22-02-SUMMARY.md
@.planning/phases/26-radarr-config-shared-arr-settings-ui/26-01-SUMMARY.md
@src/angular/src/app/services/settings/config.ts
@src/angular/src/app/services/settings/config.service.ts
@src/angular/src/app/pages/settings/settings-page.component.ts
@src/angular/src/app/pages/settings/settings-page.component.html
@src/angular/src/app/pages/settings/settings-page.component.scss
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add IRadarr model and testRadarrConnection service method</name>
  <files>
    src/angular/src/app/services/settings/config.ts
    src/angular/src/app/services/settings/config.service.ts
  </files>
  <action>
    In src/angular/src/app/services/settings/config.ts:

    1. Add IRadarr interface and RadarrRecord AFTER the Sonarr section (line ~114) and BEFORE the AutoDelete section (line ~118). Mirror Sonarr exactly:
       ```typescript
       /*
        * RADARR
        */
       interface IRadarr {
           enabled: boolean;
           radarr_url: string;
           radarr_api_key: string;
       }
       const DefaultRadarr: IRadarr = {
           enabled: null,
           radarr_url: null,
           radarr_api_key: null,
       };
       const RadarrRecord = Record(DefaultRadarr);
       ```

    2. Add `radarr: IRadarr;` to the IConfig interface (after sonarr, before autodelete at line ~141).

    3. Add `radarr: null,` to DefaultConfig (after sonarr, before autodelete at line ~150).

    4. Add `radarr: IRadarr;` to the Config class property declarations (after sonarr at line ~162).

    5. In Config constructor super() call (line ~166), add after the sonarr line and before autodelete:
       ```typescript
       radarr: props.radarr ? RadarrRecord(props.radarr) : RadarrRecord(DefaultRadarr),
       ```

    In src/angular/src/app/services/settings/config.service.ts:

    6. Add after the SONARR_TEST_URL constant (line ~25):
       ```typescript
       private readonly RADARR_TEST_URL = "/server/config/radarr/test-connection";
       ```

    7. Add after testSonarrConnection method (line ~89):
       ```typescript
       /**
        * Tests the Radarr connection using currently saved config values
        * @returns {Observable<WebReaction>}
        */
       public testRadarrConnection(): Observable<WebReaction> {
           return this._restService.sendRequest(this.RADARR_TEST_URL);
       }
       ```
  </action>
  <verify>
    Run: `cd /Users/julianamacbook/seedsync/src/angular && npx ng build --configuration production 2>&1 | tail -5`
    Build succeeds without errors.
  </verify>
  <done>
    IRadarr interface and RadarrRecord exist. IConfig includes radarr property. Config constructor handles backward-compatible Radarr Record creation. ConfigService.testRadarrConnection() calls /server/config/radarr/test-connection. Angular production build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor Settings UI into shared *arr Integration section with Sonarr + Radarr subsections</name>
  <files>
    src/angular/src/app/pages/settings/settings-page.component.ts
    src/angular/src/app/pages/settings/settings-page.component.html
    src/angular/src/app/pages/settings/settings-page.component.scss
  </files>
  <action>
    In src/angular/src/app/pages/settings/settings-page.component.ts:

    1. Rename the existing Sonarr-specific test connection state to be explicitly Sonarr-scoped. Change:
       - `testConnectionLoading` -> `testSonarrConnectionLoading`
       - `testConnectionResult` -> `testSonarrConnectionResult`
       These are currently at lines 51-52.

    2. Add Radarr test connection state after the renamed Sonarr state:
       ```typescript
       public testRadarrConnectionLoading = false;
       public testRadarrConnectionResult: {success: boolean; message: string} = null;
       ```

    3. Update onTestSonarrConnection (line ~131) to use the renamed properties:
       - `this.testConnectionLoading` -> `this.testSonarrConnectionLoading`
       - `this.testConnectionResult` -> `this.testSonarrConnectionResult`
       (All 6 occurrences within the method)

    4. Add onTestRadarrConnection method after onTestSonarrConnection. Mirror the Sonarr method exactly with these substitutions:
       - `testSonarrConnectionLoading` -> `testRadarrConnectionLoading`
       - `testSonarrConnectionResult` -> `testRadarrConnectionResult`
       - `this._configService.testSonarrConnection()` -> `this._configService.testRadarrConnection()`
       - Success message: `"Connected to Sonarr v"` -> `"Connected to Radarr v"`
       - Same markForCheck() calls (before async and after state update)

    In src/angular/src/app/pages/settings/settings-page.component.html:

    5. Replace the *arr Integration card content (lines 48-103) with a shared section containing subsection headers. The card structure stays the same (heading "arr Integration", collapse, accordion). Inside the card-body, restructure to:

       a. Add `<h4 class="subsection-header">Sonarr</h4>` before the Sonarr enable toggle
       b. Update all Sonarr test connection template bindings to use renamed properties:
          - `testConnectionLoading` -> `testSonarrConnectionLoading`
          - `testConnectionResult` -> `testSonarrConnectionResult`
       c. After the Sonarr fieldset closing tag, add the Radarr subsection:
          - `<h4 class="subsection-header">Radarr</h4>`
          - Enable Radarr Integration checkbox (same pattern as Sonarr, using `'radarr'` section and `'enabled'` key)
          - Fieldset disabled when radarr not enabled: `[attr.disabled]="!(config | async)?.get('radarr')?.get('enabled') ? '' : null"`
          - Radarr URL text field: label "Radarr URL", description "e.g. http://localhost:7878", value path `get('radarr')?.get('radarr_url')`, changeEvent `onSetConfig('radarr', 'radarr_url', $event)`
          - Radarr API Key password field: label "Radarr API Key", description "Found in Radarr under Settings -> General -> API Key" (use unicode arrow \u2192), value path `get('radarr')?.get('radarr_api_key')`, changeEvent `onSetConfig('radarr', 'radarr_api_key', $event)`
          - Test Connection button: disabled when `testRadarrConnectionLoading`, click calls `onTestRadarrConnection()`, shows "Testing..." during loading
          - Test result div: `testRadarrConnectionResult`, uses text-success/text-danger classes

       IMPORTANT: Use `*ngIf` (not `@if`) to match existing template patterns. Use `.get()` accessor methods (not dot notation) for Immutable.js Records.

    In src/angular/src/app/pages/settings/settings-page.component.scss:

    6. Add `.subsection-header` styles inside the `.card-body` rule (after line 37 `padding: 10px 0;`). Add a nested rule:
       ```scss
       .subsection-header {
           font-size: 100%;
           font-weight: 600;
           margin: 20px 20px 10px;
           color: var(--bs-secondary);

           &:first-child {
               margin-top: 0;
           }
       }
       ```
       This uses the Bootstrap secondary color variable (teal) for visual consistency with the app's accent color.
  </action>
  <verify>
    Run these commands:
    1. `cd /Users/julianamacbook/seedsync/src/angular && npx ng build --configuration production 2>&1 | tail -5` - Build succeeds
    2. `cd /Users/julianamacbook/seedsync/src/angular && npm run lint 2>&1 | tail -5` - Zero lint errors
    3. Verify template contains both subsection headers: `grep -c "subsection-header" src/angular/src/app/pages/settings/settings-page.component.html` should return 2
    4. Verify component has both test connection methods: `grep -c "onTest.*Connection" src/angular/src/app/pages/settings/settings-page.component.ts` should return 2 (method definitions)
  </verify>
  <done>
    Settings page has unified *arr Integration section with Sonarr and Radarr subsections. Each subsection has independent enable toggle, URL field, API key field, and Test Connection button with loading/result state. Sonarr subsection header reads "Sonarr", Radarr reads "Radarr". Sonarr example URL is "http://localhost:8989", Radarr is "http://localhost:7878". Angular production build passes. Zero lint errors.
  </done>
</task>

</tasks>

<verification>
1. Angular production build: `cd /Users/julianamacbook/seedsync/src/angular && npx ng build --configuration production` succeeds
2. Angular lint: `cd /Users/julianamacbook/seedsync/src/angular && npm run lint` passes with 0 errors
3. Angular unit tests: `cd /Users/julianamacbook/seedsync/src/angular && npx ng test --watch=false` passes (381+ tests, 0 failures; note 3 pre-existing failures in model-file.service.spec.ts are known/tracked for Phase 28)
4. Template has 2 subsection headers (Sonarr, Radarr) inside one *arr Integration card
5. Component has separate state for Sonarr and Radarr test connections (4 properties total)
6. ConfigService has testRadarrConnection method
7. IConfig interface includes radarr property
</verification>

<success_criteria>
- IRadarr interface with enabled, radarr_url, radarr_api_key
- Config constructor backward-compatible (handles missing radarr in JSON)
- ConfigService.testRadarrConnection() calls /server/config/radarr/test-connection
- Settings page shows unified *arr Integration section
- Sonarr subsection: enable toggle, URL (8989), API key, Test Connection
- Radarr subsection: enable toggle, URL (7878), API key, Test Connection
- Independent test connection state per service
- Angular build + lint pass
- Existing Sonarr functionality unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/26-radarr-config-shared-arr-settings-ui/26-02-SUMMARY.md`
</output>
