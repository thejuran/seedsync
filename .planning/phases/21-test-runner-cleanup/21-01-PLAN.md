---
phase: 21-test-runner-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/python/pyproject.toml
autonomous: true

must_haves:
  truths:
    - "Developer runs make run-tests-python and sees zero pytest cache warnings"
    - "Developer runs make run-tests-python and sees zero webob/bottle cgi deprecation warnings"
    - "Test output shows only test results and meaningful failures"
    - "All 952 tests continue passing with identical behavior"
  artifacts:
    - path: "src/python/pyproject.toml"
      provides: "pytest cache_dir redirect and filterwarnings for cgi deprecation"
      contains: "cache_dir"
  key_links:
    - from: "src/python/pyproject.toml"
      to: "pytest cache plugin"
      via: "cache_dir = /tmp/.pytest_cache redirects cache writes to writable path"
      pattern: 'cache_dir\s*=\s*"/tmp/\.pytest_cache"'
    - from: "src/python/pyproject.toml"
      to: "webob/bottle cgi imports"
      via: "filterwarnings ignore rule suppresses cgi DeprecationWarning"
      pattern: "ignore:'cgi' is deprecated:DeprecationWarning"
---

<objective>
Suppress pytest cache warnings and filter webob/bottle cgi deprecation warnings so that test runner output shows only meaningful test results.

Purpose: The Docker test runner (make run-tests-python) currently produces noise warnings that obscure real test output. Cache warnings occur because the Docker volume is mounted read-only, preventing .pytest_cache creation. CGI deprecation warnings occur because webob and bottle import the cgi module deprecated in Python 3.11.

Output: Updated src/python/pyproject.toml with cache_dir redirect and filterwarnings configuration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-test-runner-cleanup/21-RESEARCH.md
@src/python/pyproject.toml
@src/docker/test/python/compose.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add cache_dir and filterwarnings to pytest config</name>
  <files>src/python/pyproject.toml</files>
  <action>
In src/python/pyproject.toml, update the existing [tool.pytest.ini_options] section to add two new settings:

1. Add `cache_dir = "/tmp/.pytest_cache"` to redirect pytest cache writes to a writable path inside the Docker container. This eliminates cache warnings at the root cause (the read-only volume mount prevents writing to /src/.pytest_cache). Use /tmp because it is always writable in Docker containers, even when the source volume is read-only.

2. Add a `filterwarnings` list with a single entry: `"ignore:'cgi' is deprecated:DeprecationWarning"`. This suppresses the cgi module deprecation warning triggered by both webob/compat.py and bottle.py importing the cgi module (deprecated in Python 3.11 per PEP 594). Use message-based filtering (not module-based) to catch ALL sources of this warning in one rule.

The final [tool.pytest.ini_options] section should be:

```toml
[tool.pytest.ini_options]
pythonpath = ["."]
timeout = 60
cache_dir = "/tmp/.pytest_cache"
filterwarnings = [
    # webob and bottle both import the deprecated cgi module (Python 3.11+)
    "ignore:'cgi' is deprecated:DeprecationWarning",
]
```

Do NOT modify any other sections of pyproject.toml. Do NOT use overly broad suppression like `"ignore::DeprecationWarning"` (which would hide all deprecation warnings). Do NOT use `addopts = "-p no:cacheprovider"` (which disables --lf/--ff functionality). Do NOT use `--disable-warnings` (which hides all warnings globally).
  </action>
  <verify>
1. Read src/python/pyproject.toml and confirm the [tool.pytest.ini_options] section contains cache_dir and filterwarnings entries.
2. Run `make run-tests-python` and verify:
   - Zero lines containing "could not create cache path" in output
   - Zero lines containing "'cgi' is deprecated" in output
   - All tests pass (expect 952 passed)
   - Coverage report still appears
  </verify>
  <done>
pyproject.toml contains cache_dir = "/tmp/.pytest_cache" and filterwarnings with cgi deprecation ignore rule. Test runner output is clean: no cache warnings, no cgi deprecation warnings, all 952 tests passing, coverage report intact.
  </done>
</task>

</tasks>

<verification>
1. Read src/python/pyproject.toml and confirm only the [tool.pytest.ini_options] section changed
2. Run `make run-tests-python` and capture full output
3. Verify zero occurrences of "could not create cache path" in output
4. Verify zero occurrences of "'cgi' is deprecated" in output
5. Verify all 952 tests pass with identical behavior
6. Verify coverage report still generates and passes the 84% threshold
</verification>

<success_criteria>
- src/python/pyproject.toml has cache_dir and filterwarnings in [tool.pytest.ini_options]
- `make run-tests-python` output contains zero pytest cache warnings
- `make run-tests-python` output contains zero cgi deprecation warnings
- All 952 tests pass
- Coverage threshold (84%) still met
- No other sections of pyproject.toml modified
</success_criteria>

<output>
After completion, create `.planning/phases/21-test-runner-cleanup/21-01-SUMMARY.md`
</output>
